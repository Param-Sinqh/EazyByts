{"ast":null,"code":"import Node, { addNodeClass } from '../core/Node.js';\nimport { varyingProperty } from '../core/PropertyNode.js';\nimport { instancedBufferAttribute, instancedDynamicBufferAttribute } from './BufferAttributeNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\nimport { DynamicDrawUsage, InstancedInterleavedBuffer, InstancedBufferAttribute } from 'three';\nclass InstanceNode extends Node {\n  constructor(instanceMesh) {\n    super('void');\n    this.instanceMesh = instanceMesh;\n    this.instanceMatrixNode = null;\n    this.instanceColorNode = null;\n  }\n  setup( /*builder*/\n  ) {\n    let instanceMatrixNode = this.instanceMatrixNode;\n    const instanceMesh = this.instanceMesh;\n    if (instanceMatrixNode === null) {\n      const instanceAttribute = instanceMesh.instanceMatrix;\n      const buffer = new InstancedInterleavedBuffer(instanceAttribute.array, 16, 1);\n      const bufferFn = instanceAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n      const instanceBuffers = [\n      // F.Signature -> bufferAttribute( array, type, stride, offset )\n      bufferFn(buffer, 'vec4', 16, 0), bufferFn(buffer, 'vec4', 16, 4), bufferFn(buffer, 'vec4', 16, 8), bufferFn(buffer, 'vec4', 16, 12)];\n      instanceMatrixNode = mat4(...instanceBuffers);\n      this.instanceMatrixNode = instanceMatrixNode;\n    }\n    const instanceColorAttribute = instanceMesh.instanceColor;\n    if (instanceColorAttribute && this.instanceColorNode === null) {\n      const buffer = new InstancedBufferAttribute(instanceColorAttribute.array, 3);\n      const bufferFn = instanceColorAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n      this.instanceColorNode = vec3(bufferFn(buffer, 'vec3', 3, 0));\n    }\n\n    // POSITION\n\n    const instancePosition = instanceMatrixNode.mul(positionLocal).xyz;\n\n    // NORMAL\n\n    const m = mat3(instanceMatrixNode[0].xyz, instanceMatrixNode[1].xyz, instanceMatrixNode[2].xyz);\n    const transformedNormal = normalLocal.div(vec3(m[0].dot(m[0]), m[1].dot(m[1]), m[2].dot(m[2])));\n    const instanceNormal = m.mul(transformedNormal).xyz;\n\n    // ASSIGNS\n\n    positionLocal.assign(instancePosition);\n    normalLocal.assign(instanceNormal);\n\n    // COLOR\n\n    if (this.instanceColorNode !== null) {\n      varyingProperty('vec3', 'vInstanceColor').assign(this.instanceColorNode);\n    }\n  }\n}\nexport default InstanceNode;\nexport const instance = nodeProxy(InstanceNode);\naddNodeClass('InstanceNode', InstanceNode);","map":{"version":3,"names":["Node","addNodeClass","varyingProperty","instancedBufferAttribute","instancedDynamicBufferAttribute","normalLocal","positionLocal","nodeProxy","vec3","mat3","mat4","DynamicDrawUsage","InstancedInterleavedBuffer","InstancedBufferAttribute","InstanceNode","constructor","instanceMesh","instanceMatrixNode","instanceColorNode","setup","instanceAttribute","instanceMatrix","buffer","array","bufferFn","usage","instanceBuffers","instanceColorAttribute","instanceColor","instancePosition","mul","xyz","m","transformedNormal","div","dot","instanceNormal","assign","instance"],"sources":["D:/dumps/online-learning-platform-main/Frontend/node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { varyingProperty } from '../core/PropertyNode.js';\nimport { instancedBufferAttribute, instancedDynamicBufferAttribute } from './BufferAttributeNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\nimport { DynamicDrawUsage, InstancedInterleavedBuffer, InstancedBufferAttribute } from 'three';\n\nclass InstanceNode extends Node {\n\n\tconstructor( instanceMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.instanceMesh = instanceMesh;\n\n\t\tthis.instanceMatrixNode = null;\n\n\t\tthis.instanceColorNode = null;\n\n\t}\n\n\tsetup( /*builder*/ ) {\n\n\t\tlet instanceMatrixNode = this.instanceMatrixNode;\n\n\t\tconst instanceMesh = this.instanceMesh;\n\n\t\tif ( instanceMatrixNode === null ) {\n\n\t\t\tconst instanceAttribute = instanceMesh.instanceMatrix;\n\t\t\tconst buffer = new InstancedInterleavedBuffer( instanceAttribute.array, 16, 1 );\n\n\t\t\tconst bufferFn = instanceAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n\n\t\t\tconst instanceBuffers = [\n\t\t\t\t// F.Signature -> bufferAttribute( array, type, stride, offset )\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 0 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 4 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 8 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 12 )\n\t\t\t];\n\n\t\t\tinstanceMatrixNode = mat4( ...instanceBuffers );\n\n\t\t\tthis.instanceMatrixNode = instanceMatrixNode;\n\n\t\t}\n\n\t\tconst instanceColorAttribute = instanceMesh.instanceColor;\n\n\t\tif ( instanceColorAttribute && this.instanceColorNode === null ) {\n\n\t\t\tconst buffer = new InstancedBufferAttribute( instanceColorAttribute.array, 3 );\n\t\t\tconst bufferFn = instanceColorAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n\n\t\t\tthis.instanceColorNode = vec3( bufferFn( buffer, 'vec3', 3, 0 ) );\n\n\t\t}\n\n\t\t// POSITION\n\n\t\tconst instancePosition = instanceMatrixNode.mul( positionLocal ).xyz;\n\n\t\t// NORMAL\n\n\t\tconst m = mat3( instanceMatrixNode[ 0 ].xyz, instanceMatrixNode[ 1 ].xyz, instanceMatrixNode[ 2 ].xyz );\n\n\t\tconst transformedNormal = normalLocal.div( vec3( m[ 0 ].dot( m[ 0 ] ), m[ 1 ].dot( m[ 1 ] ), m[ 2 ].dot( m[ 2 ] ) ) );\n\n\t\tconst instanceNormal = m.mul( transformedNormal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tpositionLocal.assign( instancePosition );\n\t\tnormalLocal.assign( instanceNormal );\n\n\t\t// COLOR\n\n\t\tif ( this.instanceColorNode !== null ) {\n\n\t\t\tvaryingProperty( 'vec3', 'vInstanceColor' ).assign( this.instanceColorNode );\n\n\t\t}\n\n\t}\n\n}\n\nexport default InstanceNode;\n\nexport const instance = nodeProxy( InstanceNode );\n\naddNodeClass( 'InstanceNode', InstanceNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}