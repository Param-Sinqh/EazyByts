{"ast":null,"code":"import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeObject } from '../shadernode/ShaderNode.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { reference, referenceBuffer } from './ReferenceNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { tangentLocal } from './TangentNode.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { buffer } from './BufferNode.js';\nclass SkinningNode extends Node {\n  constructor(skinnedMesh, useReference = false) {\n    super('void');\n    this.skinnedMesh = skinnedMesh;\n    this.useReference = useReference;\n    this.updateType = NodeUpdateType.OBJECT;\n\n    //\n\n    this.skinIndexNode = attribute('skinIndex', 'uvec4');\n    this.skinWeightNode = attribute('skinWeight', 'vec4');\n    let bindMatrixNode, bindMatrixInverseNode, boneMatricesNode;\n    if (useReference) {\n      bindMatrixNode = reference('bindMatrix', 'mat4');\n      bindMatrixInverseNode = reference('bindMatrixInverse', 'mat4');\n      boneMatricesNode = referenceBuffer('skeleton.boneMatrices', 'mat4', skinnedMesh.skeleton.bones.length);\n    } else {\n      bindMatrixNode = uniform(skinnedMesh.bindMatrix, 'mat4');\n      bindMatrixInverseNode = uniform(skinnedMesh.bindMatrixInverse, 'mat4');\n      boneMatricesNode = buffer(skinnedMesh.skeleton.boneMatrices, 'mat4', skinnedMesh.skeleton.bones.length);\n    }\n    this.bindMatrixNode = bindMatrixNode;\n    this.bindMatrixInverseNode = bindMatrixInverseNode;\n    this.boneMatricesNode = boneMatricesNode;\n  }\n  setup(builder) {\n    const {\n      skinIndexNode,\n      skinWeightNode,\n      bindMatrixNode,\n      bindMatrixInverseNode,\n      boneMatricesNode\n    } = this;\n    const boneMatX = boneMatricesNode.element(skinIndexNode.x);\n    const boneMatY = boneMatricesNode.element(skinIndexNode.y);\n    const boneMatZ = boneMatricesNode.element(skinIndexNode.z);\n    const boneMatW = boneMatricesNode.element(skinIndexNode.w);\n\n    // POSITION\n\n    const skinVertex = bindMatrixNode.mul(positionLocal);\n    const skinned = add(boneMatX.mul(skinWeightNode.x).mul(skinVertex), boneMatY.mul(skinWeightNode.y).mul(skinVertex), boneMatZ.mul(skinWeightNode.z).mul(skinVertex), boneMatW.mul(skinWeightNode.w).mul(skinVertex));\n    const skinPosition = bindMatrixInverseNode.mul(skinned).xyz;\n\n    // NORMAL\n\n    let skinMatrix = add(skinWeightNode.x.mul(boneMatX), skinWeightNode.y.mul(boneMatY), skinWeightNode.z.mul(boneMatZ), skinWeightNode.w.mul(boneMatW));\n    skinMatrix = bindMatrixInverseNode.mul(skinMatrix).mul(bindMatrixNode);\n    const skinNormal = skinMatrix.transformDirection(normalLocal).xyz;\n\n    // ASSIGNS\n\n    positionLocal.assign(skinPosition);\n    normalLocal.assign(skinNormal);\n    if (builder.hasGeometryAttribute('tangent')) {\n      tangentLocal.assign(skinNormal);\n    }\n  }\n  generate(builder, output) {\n    if (output !== 'void') {\n      return positionLocal.build(builder, output);\n    }\n  }\n  update(frame) {\n    const object = this.useReference ? frame.object : this.skinnedMesh;\n    object.skeleton.update();\n  }\n}\nexport default SkinningNode;\nexport const skinning = skinnedMesh => nodeObject(new SkinningNode(skinnedMesh));\nexport const skinningReference = skinnedMesh => nodeObject(new SkinningNode(skinnedMesh, true));\naddNodeClass('SkinningNode', SkinningNode);","map":{"version":3,"names":["Node","addNodeClass","NodeUpdateType","nodeObject","attribute","reference","referenceBuffer","add","normalLocal","positionLocal","tangentLocal","uniform","buffer","SkinningNode","constructor","skinnedMesh","useReference","updateType","OBJECT","skinIndexNode","skinWeightNode","bindMatrixNode","bindMatrixInverseNode","boneMatricesNode","skeleton","bones","length","bindMatrix","bindMatrixInverse","boneMatrices","setup","builder","boneMatX","element","x","boneMatY","y","boneMatZ","z","boneMatW","w","skinVertex","mul","skinned","skinPosition","xyz","skinMatrix","skinNormal","transformDirection","assign","hasGeometryAttribute","generate","output","build","update","frame","object","skinning","skinningReference"],"sources":["D:/dumps/online-learning-platform-main/Frontend/node_modules/three/examples/jsm/nodes/accessors/SkinningNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeObject } from '../shadernode/ShaderNode.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { reference, referenceBuffer } from './ReferenceNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { tangentLocal } from './TangentNode.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { buffer } from './BufferNode.js';\n\nclass SkinningNode extends Node {\n\n\tconstructor( skinnedMesh, useReference = false ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.skinnedMesh = skinnedMesh;\n\t\tthis.useReference = useReference;\n\n\t\tthis.updateType = NodeUpdateType.OBJECT;\n\n\t\t//\n\n\t\tthis.skinIndexNode = attribute( 'skinIndex', 'uvec4' );\n\t\tthis.skinWeightNode = attribute( 'skinWeight', 'vec4' );\n\n\t\tlet bindMatrixNode, bindMatrixInverseNode, boneMatricesNode;\n\n\t\tif ( useReference ) {\n\n\t\t\tbindMatrixNode = reference( 'bindMatrix', 'mat4' );\n\t\t\tbindMatrixInverseNode = reference( 'bindMatrixInverse', 'mat4' );\n\t\t\tboneMatricesNode = referenceBuffer( 'skeleton.boneMatrices', 'mat4', skinnedMesh.skeleton.bones.length );\n\n\t\t} else {\n\n\t\t\tbindMatrixNode = uniform( skinnedMesh.bindMatrix, 'mat4' );\n\t\t\tbindMatrixInverseNode = uniform( skinnedMesh.bindMatrixInverse, 'mat4' );\n\t\t\tboneMatricesNode = buffer( skinnedMesh.skeleton.boneMatrices, 'mat4', skinnedMesh.skeleton.bones.length );\n\n\t\t}\n\n\t\tthis.bindMatrixNode = bindMatrixNode;\n\t\tthis.bindMatrixInverseNode = bindMatrixInverseNode;\n\t\tthis.boneMatricesNode = boneMatricesNode;\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tconst { skinIndexNode, skinWeightNode, bindMatrixNode, bindMatrixInverseNode, boneMatricesNode } = this;\n\n\t\tconst boneMatX = boneMatricesNode.element( skinIndexNode.x );\n\t\tconst boneMatY = boneMatricesNode.element( skinIndexNode.y );\n\t\tconst boneMatZ = boneMatricesNode.element( skinIndexNode.z );\n\t\tconst boneMatW = boneMatricesNode.element( skinIndexNode.w );\n\n\t\t// POSITION\n\n\t\tconst skinVertex = bindMatrixNode.mul( positionLocal );\n\n\t\tconst skinned = add(\n\t\t\tboneMatX.mul( skinWeightNode.x ).mul( skinVertex ),\n\t\t\tboneMatY.mul( skinWeightNode.y ).mul( skinVertex ),\n\t\t\tboneMatZ.mul( skinWeightNode.z ).mul( skinVertex ),\n\t\t\tboneMatW.mul( skinWeightNode.w ).mul( skinVertex )\n\t\t);\n\n\t\tconst skinPosition = bindMatrixInverseNode.mul( skinned ).xyz;\n\n\t\t// NORMAL\n\n\t\tlet skinMatrix = add(\n\t\t\tskinWeightNode.x.mul( boneMatX ),\n\t\t\tskinWeightNode.y.mul( boneMatY ),\n\t\t\tskinWeightNode.z.mul( boneMatZ ),\n\t\t\tskinWeightNode.w.mul( boneMatW )\n\t\t);\n\n\t\tskinMatrix = bindMatrixInverseNode.mul( skinMatrix ).mul( bindMatrixNode );\n\n\t\tconst skinNormal = skinMatrix.transformDirection( normalLocal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tpositionLocal.assign( skinPosition );\n\t\tnormalLocal.assign( skinNormal );\n\n\t\tif ( builder.hasGeometryAttribute( 'tangent' ) ) {\n\n\t\t\ttangentLocal.assign( skinNormal );\n\n\t\t}\n\n\t}\n\n\tgenerate( builder, output ) {\n\n\t\tif ( output !== 'void' ) {\n\n\t\t\treturn positionLocal.build( builder, output );\n\n\t\t}\n\n\t}\n\n\tupdate( frame ) {\n\n\t\tconst object = this.useReference ? frame.object : this.skinnedMesh;\n\n\t\tobject.skeleton.update();\n\n\t}\n\n}\n\nexport default SkinningNode;\n\nexport const skinning = ( skinnedMesh ) => nodeObject( new SkinningNode( skinnedMesh ) );\nexport const skinningReference = ( skinnedMesh ) => nodeObject( new SkinningNode( skinnedMesh, true ) );\n\naddNodeClass( 'SkinningNode', SkinningNode );\n"],"mappings":"AAAA,OAAOA,IAAI,IAAIC,YAAY,QAAQ,iBAAiB;AACpD,SAASC,cAAc,QAAQ,sBAAsB;AACrD,SAASC,UAAU,QAAQ,6BAA6B;AACxD,SAASC,SAAS,QAAQ,0BAA0B;AACpD,SAASC,SAAS,EAAEC,eAAe,QAAQ,oBAAoB;AAC/D,SAASC,GAAG,QAAQ,yBAAyB;AAC7C,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,aAAa,QAAQ,mBAAmB;AACjD,SAASC,YAAY,QAAQ,kBAAkB;AAC/C,SAASC,OAAO,QAAQ,wBAAwB;AAChD,SAASC,MAAM,QAAQ,iBAAiB;AAExC,MAAMC,YAAY,SAASb,IAAI,CAAC;EAE/Bc,WAAWA,CAAEC,WAAW,EAAEC,YAAY,GAAG,KAAK,EAAG;IAEhD,KAAK,CAAE,MAAO,CAAC;IAEf,IAAI,CAACD,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,YAAY,GAAGA,YAAY;IAEhC,IAAI,CAACC,UAAU,GAAGf,cAAc,CAACgB,MAAM;;IAEvC;;IAEA,IAAI,CAACC,aAAa,GAAGf,SAAS,CAAE,WAAW,EAAE,OAAQ,CAAC;IACtD,IAAI,CAACgB,cAAc,GAAGhB,SAAS,CAAE,YAAY,EAAE,MAAO,CAAC;IAEvD,IAAIiB,cAAc,EAAEC,qBAAqB,EAAEC,gBAAgB;IAE3D,IAAKP,YAAY,EAAG;MAEnBK,cAAc,GAAGhB,SAAS,CAAE,YAAY,EAAE,MAAO,CAAC;MAClDiB,qBAAqB,GAAGjB,SAAS,CAAE,mBAAmB,EAAE,MAAO,CAAC;MAChEkB,gBAAgB,GAAGjB,eAAe,CAAE,uBAAuB,EAAE,MAAM,EAAES,WAAW,CAACS,QAAQ,CAACC,KAAK,CAACC,MAAO,CAAC;IAEzG,CAAC,MAAM;MAENL,cAAc,GAAGV,OAAO,CAAEI,WAAW,CAACY,UAAU,EAAE,MAAO,CAAC;MAC1DL,qBAAqB,GAAGX,OAAO,CAAEI,WAAW,CAACa,iBAAiB,EAAE,MAAO,CAAC;MACxEL,gBAAgB,GAAGX,MAAM,CAAEG,WAAW,CAACS,QAAQ,CAACK,YAAY,EAAE,MAAM,EAAEd,WAAW,CAACS,QAAQ,CAACC,KAAK,CAACC,MAAO,CAAC;IAE1G;IAEA,IAAI,CAACL,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACC,qBAAqB,GAAGA,qBAAqB;IAClD,IAAI,CAACC,gBAAgB,GAAGA,gBAAgB;EAEzC;EAEAO,KAAKA,CAAEC,OAAO,EAAG;IAEhB,MAAM;MAAEZ,aAAa;MAAEC,cAAc;MAAEC,cAAc;MAAEC,qBAAqB;MAAEC;IAAiB,CAAC,GAAG,IAAI;IAEvG,MAAMS,QAAQ,GAAGT,gBAAgB,CAACU,OAAO,CAAEd,aAAa,CAACe,CAAE,CAAC;IAC5D,MAAMC,QAAQ,GAAGZ,gBAAgB,CAACU,OAAO,CAAEd,aAAa,CAACiB,CAAE,CAAC;IAC5D,MAAMC,QAAQ,GAAGd,gBAAgB,CAACU,OAAO,CAAEd,aAAa,CAACmB,CAAE,CAAC;IAC5D,MAAMC,QAAQ,GAAGhB,gBAAgB,CAACU,OAAO,CAAEd,aAAa,CAACqB,CAAE,CAAC;;IAE5D;;IAEA,MAAMC,UAAU,GAAGpB,cAAc,CAACqB,GAAG,CAAEjC,aAAc,CAAC;IAEtD,MAAMkC,OAAO,GAAGpC,GAAG,CAClByB,QAAQ,CAACU,GAAG,CAAEtB,cAAc,CAACc,CAAE,CAAC,CAACQ,GAAG,CAAED,UAAW,CAAC,EAClDN,QAAQ,CAACO,GAAG,CAAEtB,cAAc,CAACgB,CAAE,CAAC,CAACM,GAAG,CAAED,UAAW,CAAC,EAClDJ,QAAQ,CAACK,GAAG,CAAEtB,cAAc,CAACkB,CAAE,CAAC,CAACI,GAAG,CAAED,UAAW,CAAC,EAClDF,QAAQ,CAACG,GAAG,CAAEtB,cAAc,CAACoB,CAAE,CAAC,CAACE,GAAG,CAAED,UAAW,CAClD,CAAC;IAED,MAAMG,YAAY,GAAGtB,qBAAqB,CAACoB,GAAG,CAAEC,OAAQ,CAAC,CAACE,GAAG;;IAE7D;;IAEA,IAAIC,UAAU,GAAGvC,GAAG,CACnBa,cAAc,CAACc,CAAC,CAACQ,GAAG,CAAEV,QAAS,CAAC,EAChCZ,cAAc,CAACgB,CAAC,CAACM,GAAG,CAAEP,QAAS,CAAC,EAChCf,cAAc,CAACkB,CAAC,CAACI,GAAG,CAAEL,QAAS,CAAC,EAChCjB,cAAc,CAACoB,CAAC,CAACE,GAAG,CAAEH,QAAS,CAChC,CAAC;IAEDO,UAAU,GAAGxB,qBAAqB,CAACoB,GAAG,CAAEI,UAAW,CAAC,CAACJ,GAAG,CAAErB,cAAe,CAAC;IAE1E,MAAM0B,UAAU,GAAGD,UAAU,CAACE,kBAAkB,CAAExC,WAAY,CAAC,CAACqC,GAAG;;IAEnE;;IAEApC,aAAa,CAACwC,MAAM,CAAEL,YAAa,CAAC;IACpCpC,WAAW,CAACyC,MAAM,CAAEF,UAAW,CAAC;IAEhC,IAAKhB,OAAO,CAACmB,oBAAoB,CAAE,SAAU,CAAC,EAAG;MAEhDxC,YAAY,CAACuC,MAAM,CAAEF,UAAW,CAAC;IAElC;EAED;EAEAI,QAAQA,CAAEpB,OAAO,EAAEqB,MAAM,EAAG;IAE3B,IAAKA,MAAM,KAAK,MAAM,EAAG;MAExB,OAAO3C,aAAa,CAAC4C,KAAK,CAAEtB,OAAO,EAAEqB,MAAO,CAAC;IAE9C;EAED;EAEAE,MAAMA,CAAEC,KAAK,EAAG;IAEf,MAAMC,MAAM,GAAG,IAAI,CAACxC,YAAY,GAAGuC,KAAK,CAACC,MAAM,GAAG,IAAI,CAACzC,WAAW;IAElEyC,MAAM,CAAChC,QAAQ,CAAC8B,MAAM,CAAC,CAAC;EAEzB;AAED;AAEA,eAAezC,YAAY;AAE3B,OAAO,MAAM4C,QAAQ,GAAK1C,WAAW,IAAMZ,UAAU,CAAE,IAAIU,YAAY,CAAEE,WAAY,CAAE,CAAC;AACxF,OAAO,MAAM2C,iBAAiB,GAAK3C,WAAW,IAAMZ,UAAU,CAAE,IAAIU,YAAY,CAAEE,WAAW,EAAE,IAAK,CAAE,CAAC;AAEvGd,YAAY,CAAE,cAAc,EAAEY,YAAa,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}