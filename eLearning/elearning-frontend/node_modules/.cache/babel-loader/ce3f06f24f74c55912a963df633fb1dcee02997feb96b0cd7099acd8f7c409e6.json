{"ast":null,"code":"import TempNode from '../core/TempNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { textureCubeUV } from './PMREMUtils.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeProxy, vec3 } from '../shadernode/ShaderNode.js';\nimport { WebGLCoordinateSystem } from 'three';\nlet _generator = null;\nconst _cache = new WeakMap();\nfunction _generateCubeUVSize(imageHeight) {\n  const maxMip = Math.log2(imageHeight) - 2;\n  const texelHeight = 1.0 / imageHeight;\n  const texelWidth = 1.0 / (3 * Math.max(Math.pow(2, maxMip), 7 * 16));\n  return {\n    texelWidth,\n    texelHeight,\n    maxMip\n  };\n}\nfunction _getPMREMFromTexture(texture) {\n  let cacheTexture = _cache.get(texture);\n  const pmremVersion = cacheTexture !== undefined ? cacheTexture.pmremVersion : -1;\n  if (pmremVersion !== texture.pmremVersion) {\n    if (texture.isCubeTexture) {\n      if (texture.source.data.some(texture => texture === undefined)) {\n        throw new Error('PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader');\n      }\n      cacheTexture = _generator.fromCubemap(texture, cacheTexture);\n    } else {\n      if (texture.image === undefined) {\n        throw new Error('PMREMNode: Undefined image in Texture. Use onLoad callback or async loader');\n      }\n      cacheTexture = _generator.fromEquirectangular(texture, cacheTexture);\n    }\n    cacheTexture.pmremVersion = texture.pmremVersion;\n    _cache.set(texture, cacheTexture);\n  }\n  return cacheTexture.texture;\n}\nclass PMREMNode extends TempNode {\n  constructor(value, uvNode = null, levelNode = null) {\n    super('vec3');\n    this._value = value;\n    this._pmrem = null;\n    this.uvNode = uvNode;\n    this.levelNode = levelNode;\n    this._generator = null;\n    this._texture = texture(null);\n    this._width = uniform(0);\n    this._height = uniform(0);\n    this._maxMip = uniform(0);\n    this.updateBeforeType = NodeUpdateType.RENDER;\n  }\n  set value(value) {\n    this._value = value;\n    this._pmrem = null;\n  }\n  get value() {\n    return this._value;\n  }\n  updateFromTexture(texture) {\n    const cubeUVSize = _generateCubeUVSize(texture.image.height);\n    this._texture.value = texture;\n    this._width.value = cubeUVSize.texelWidth;\n    this._height.value = cubeUVSize.texelHeight;\n    this._maxMip.value = cubeUVSize.maxMip;\n  }\n  updateBefore() {\n    let pmrem = this._pmrem;\n    const pmremVersion = pmrem ? pmrem.pmremVersion : -1;\n    const texture = this._value;\n    if (pmremVersion !== texture.pmremVersion) {\n      if (texture.isPMREMTexture === true) {\n        pmrem = texture;\n      } else {\n        pmrem = _getPMREMFromTexture(texture);\n      }\n      this._pmrem = pmrem;\n      this.updateFromTexture(pmrem);\n    }\n  }\n  setup(builder) {\n    if (_generator === null) {\n      _generator = builder.createPMREMGenerator();\n    }\n\n    //\n\n    this.updateBefore(builder);\n\n    //\n\n    let uvNode = this.uvNode;\n    if (uvNode === null && builder.context.getUV) {\n      uvNode = builder.context.getUV(this);\n    }\n\n    //\n\n    const texture = this.value;\n    if (builder.renderer.coordinateSystem === WebGLCoordinateSystem && texture.isPMREMTexture !== true && texture.isRenderTargetTexture === true) {\n      uvNode = vec3(uvNode.x.negate(), uvNode.yz);\n    }\n\n    //\n\n    let levelNode = this.levelNode;\n    if (levelNode === null && builder.context.getTextureLevel) {\n      levelNode = builder.context.getTextureLevel(this);\n    }\n\n    //\n\n    return textureCubeUV(this._texture, uvNode, levelNode, this._width, this._height, this._maxMip);\n  }\n}\nexport const pmremTexture = nodeProxy(PMREMNode);\naddNodeClass('PMREMNode', PMREMNode);\nexport default PMREMNode;","map":{"version":3,"names":["TempNode","addNodeClass","texture","textureCubeUV","uniform","NodeUpdateType","nodeProxy","vec3","WebGLCoordinateSystem","_generator","_cache","WeakMap","_generateCubeUVSize","imageHeight","maxMip","Math","log2","texelHeight","texelWidth","max","pow","_getPMREMFromTexture","cacheTexture","get","pmremVersion","undefined","isCubeTexture","source","data","some","Error","fromCubemap","image","fromEquirectangular","set","PMREMNode","constructor","value","uvNode","levelNode","_value","_pmrem","_texture","_width","_height","_maxMip","updateBeforeType","RENDER","updateFromTexture","cubeUVSize","height","updateBefore","pmrem","isPMREMTexture","setup","builder","createPMREMGenerator","context","getUV","renderer","coordinateSystem","isRenderTargetTexture","x","negate","yz","getTextureLevel","pmremTexture"],"sources":["D:/dumps/online-learning-platform-main/Frontend/node_modules/three/examples/jsm/nodes/pmrem/PMREMNode.js"],"sourcesContent":["import TempNode from '../core/TempNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { textureCubeUV } from './PMREMUtils.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeProxy, vec3 } from '../shadernode/ShaderNode.js';\nimport { WebGLCoordinateSystem } from 'three';\n\nlet _generator = null;\n\nconst _cache = new WeakMap();\n\nfunction _generateCubeUVSize( imageHeight ) {\n\n\tconst maxMip = Math.log2( imageHeight ) - 2;\n\n\tconst texelHeight = 1.0 / imageHeight;\n\n\tconst texelWidth = 1.0 / ( 3 * Math.max( Math.pow( 2, maxMip ), 7 * 16 ) );\n\n\treturn { texelWidth, texelHeight, maxMip };\n\n}\n\nfunction _getPMREMFromTexture( texture ) {\n\n\tlet cacheTexture = _cache.get( texture );\n\n\tconst pmremVersion = cacheTexture !== undefined ? cacheTexture.pmremVersion : - 1;\n\n\tif ( pmremVersion !== texture.pmremVersion ) {\n\n\t\tif ( texture.isCubeTexture ) {\n\n\t\t\tif ( texture.source.data.some( ( texture ) => texture === undefined ) ) {\n\n\t\t\t\tthrow new Error( 'PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader' );\n\n\t\t\t}\n\n\t\t\tcacheTexture = _generator.fromCubemap( texture, cacheTexture );\n\n\t\t} else {\n\n\t\t\tif ( texture.image === undefined ) {\n\n\t\t\t\tthrow new Error( 'PMREMNode: Undefined image in Texture. Use onLoad callback or async loader' );\n\n\t\t\t}\n\n\t\t\tcacheTexture = _generator.fromEquirectangular( texture, cacheTexture );\n\n\t\t}\n\n\t\tcacheTexture.pmremVersion = texture.pmremVersion;\n\n\t\t_cache.set( texture, cacheTexture );\n\n\t}\n\n\treturn cacheTexture.texture;\n\n}\n\nclass PMREMNode extends TempNode {\n\n\tconstructor( value, uvNode = null, levelNode = null ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis._value = value;\n\t\tthis._pmrem = null;\n\n\t\tthis.uvNode = uvNode;\n\t\tthis.levelNode = levelNode;\n\n\t\tthis._generator = null;\n\t\tthis._texture = texture( null );\n\t\tthis._width = uniform( 0 );\n\t\tthis._height = uniform( 0 );\n\t\tthis._maxMip = uniform( 0 );\n\n\t\tthis.updateBeforeType = NodeUpdateType.RENDER;\n\n\t}\n\n\tset value( value ) {\n\n\t\tthis._value = value;\n\t\tthis._pmrem = null;\n\n\t}\n\n\tget value() {\n\n\t\treturn this._value;\n\n\t}\n\n\tupdateFromTexture( texture ) {\n\n\t\tconst cubeUVSize = _generateCubeUVSize( texture.image.height );\n\n\t\tthis._texture.value = texture;\n\t\tthis._width.value = cubeUVSize.texelWidth;\n\t\tthis._height.value = cubeUVSize.texelHeight;\n\t\tthis._maxMip.value = cubeUVSize.maxMip;\n\n\t}\n\n\tupdateBefore() {\n\n\t\tlet pmrem = this._pmrem;\n\n\t\tconst pmremVersion = pmrem ? pmrem.pmremVersion : - 1;\n\t\tconst texture = this._value;\n\n\t\tif ( pmremVersion !== texture.pmremVersion ) {\n\n\t\t\tif ( texture.isPMREMTexture === true ) {\n\n\t\t\t\tpmrem = texture;\n\n\t\t\t} else {\n\n\t\t\t\tpmrem = _getPMREMFromTexture( texture );\n\n\t\t\t}\n\n\t\t\tthis._pmrem = pmrem;\n\n\t\t\tthis.updateFromTexture( pmrem );\n\n\t\t}\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tif ( _generator === null ) {\n\n\t\t\t_generator = builder.createPMREMGenerator();\n\n\t\t}\n\n\t\t//\n\n\t\tthis.updateBefore( builder );\n\n\t\t//\n\n\t\tlet uvNode = this.uvNode;\n\n\t\tif ( uvNode === null && builder.context.getUV ) {\n\n\t\t\tuvNode = builder.context.getUV( this );\n\n\t\t}\n\n\t\t//\n\n\t\tconst texture = this.value;\n\n\t\tif ( builder.renderer.coordinateSystem === WebGLCoordinateSystem && texture.isPMREMTexture !== true && texture.isRenderTargetTexture === true ) {\n\n\t\t\tuvNode = vec3( uvNode.x.negate(), uvNode.yz );\n\n\t\t}\n\n\t\t//\n\n\t\tlet levelNode = this.levelNode;\n\n\t\tif ( levelNode === null && builder.context.getTextureLevel ) {\n\n\t\t\tlevelNode = builder.context.getTextureLevel( this );\n\n\t\t}\n\n\t\t//\n\n\t\treturn textureCubeUV( this._texture, uvNode, levelNode, this._width, this._height, this._maxMip );\n\n\t}\n\n}\n\nexport const pmremTexture = nodeProxy( PMREMNode );\n\naddNodeClass( 'PMREMNode', PMREMNode );\n\nexport default PMREMNode;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}